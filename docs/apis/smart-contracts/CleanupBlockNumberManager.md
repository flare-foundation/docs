---
title: CleanupBlockNumberManager
---

<!-- This is an autogenerated file. Do not edit! -->

# `CleanupBlockNumberManager` { #ct_cleanupblocknumbermanager }

<div class="api-node-source" markdown>
[Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol) | Inherits from [Governed](./Governed.md), [AddressUpdatable](./AddressUpdatable.md)
</div>

<div class="api-node-internal" markdown>

Token history cleanup manager.

Maintains the list of cleanable tokens for which history cleanup can be collectively executed.

</div>

<div class="api-node-type" markdown>

## Events

<div class="api-node" markdown>

### `CleanupBlockNumberSet` { #ev_cleanupblocknumberset }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event CleanupBlockNumberSet(
    contract IICleanable theContract,
    uint256 blockNumber,
    bool success
)
```

Emitted when an attempt has been made to set the cleanup block number.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `theContract` | `contract IICleanable` | The token contract address. |
| `blockNumber` | `uint256` | The block number being set. |
| `success` | `bool` | Whether it succeeded or not. |

</div>
</div>

<div class="api-node" markdown>

### `GovernanceCallTimelocked` { #ev_governancecalltimelocked }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event GovernanceCallTimelocked(
    bytes4 selector,
    uint256 allowedAfterTimestamp,
    bytes encodedCall
)
```

Emitted when a new [`governance`](#fn_governance_5aa6e675) call has been recorded and is now waiting for the time lock to expire.

</div>
</div>

<div class="api-node" markdown>

### `GovernanceInitialised` { #ev_governanceinitialised }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event GovernanceInitialised(
    address initialGovernance
)
```

Emitted when the [`governance`](#fn_governance_5aa6e675) address is initialized.
This address will be used until production mode is entered (see [`GovernedProductionModeEntered`](#ev_governedproductionmodeentered)).
At that point the [`governance`](#fn_governance_5aa6e675) address is taken from [`GovernanceSettings`](./GovernanceSettings.md).

</div>
</div>

<div class="api-node" markdown>

### `GovernedProductionModeEntered` { #ev_governedproductionmodeentered }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event GovernedProductionModeEntered(
    address governanceSettings
)
```

Emitted when [`governance`](#fn_governance_5aa6e675) is enabled and the [`governance`](#fn_governance_5aa6e675) address cannot be changed anymore
(only through a network fork).

</div>
</div>

<div class="api-node" markdown>

### `RegistrationUpdated` { #ev_registrationupdated }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event RegistrationUpdated(
    contract IICleanable theContract,
    bool add
)
```

Emitted when a new token has been registered to have its history managed by us, or
an old one unregistered.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `theContract` | `contract IICleanable` | The token contract address. |
| `add` | `bool` | **true** is the token has been registered, **false** if unregistered. |

</div>
</div>

<div class="api-node" markdown>

### `TimelockedGovernanceCallCanceled` { #ev_timelockedgovernancecallcanceled }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event TimelockedGovernanceCallCanceled(
    bytes4 selector,
    uint256 timestamp
)
```

Emitted when a timelocked [`governance`](#fn_governance_5aa6e675) call is canceled before execution.

</div>
</div>

<div class="api-node" markdown>

### `TimelockedGovernanceCallExecuted` { #ev_timelockedgovernancecallexecuted }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
event TimelockedGovernanceCallExecuted(
    bytes4 selector,
    uint256 timestamp
)
```

Emitted when a timelocked [`governance`](#fn_governance_5aa6e675) call is executed.

</div>
</div>

</div>

<div class="api-node-type" markdown>

## Functions

<div class="api-node" markdown>

### `cancelGovernanceCall` { #fn_cancelgovernancecall_67fc4029 }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function cancelGovernanceCall(
    bytes4 _selector
) external;
```

Cancel a timelocked [`governance`](#fn_governance_5aa6e675) call before it has been executed.

Only [`governance`](#fn_governance_5aa6e675) can call this method.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `_selector` | `bytes4` | The method selector. |

</div>
</div>

<div class="api-node" markdown>

### `constructor` { #fn_constructor_undefined }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
constructor(
    address _governance,
    address _addressUpdater,
    string _triggerContractName
) public;
```

Build a new instance.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `_governance` | `address` | Contract address that can make governance calls. See [`Governed`](./Governed.md). |
| `_addressUpdater` | `address` | Contract address that can update redeployable addresses. See `AdressUpdatable`. |
| `_triggerContractName` | `string` | Contract name that can trigger history cleanups. |

</div>
</div>

<div class="api-node" markdown>

### `executeGovernanceCall` { #fn_executegovernancecall_5ff27079 }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function executeGovernanceCall(
    bytes4 _selector
) external;
```

Execute the timelocked [`governance`](#fn_governance_5aa6e675) calls once the timelock period expires.

Only executor can call this method.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `_selector` | `bytes4` | The method selector (only one timelocked call per method is stored). |

</div>
</div>

<div class="api-node" markdown>

### `getAddressUpdater` { #fn_getaddressupdater_5267a15d }

<div class="api-node-source" markdown>
Defined in `AddressUpdatable` ([Docs](./AddressUpdatable.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/addressUpdater/implementation/AddressUpdatable.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function getAddressUpdater(
) public view returns (
    address _addressUpdater);
```

Returns the configured address updater.

| Returns | Type | Description |
| ------- | ---- | ----------- |
| `_addressUpdater` | `address` | The `AddresUpdater` contract that can update our contract address list, as a response to a governance call. |
</div>
</div>

<div class="api-node" markdown>

### `governance` { #fn_governance_5aa6e675 }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function governance(
) public view returns (
    address);
```

Returns the current effective [`governance`](#fn_governance_5aa6e675) address.

</div>
</div>

<div class="api-node" markdown>

### `registerToken` { #fn_registertoken_09824a80 }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function registerToken(
    contract IICleanable _cleanableToken
) external;
```

Register a token contract whose history cleanup index is to be managed.
The registered contracts must allow calling `setCleanupBlockNumber`.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `_cleanableToken` | `contract IICleanable` | The address of the contract to be managed. |

</div>
</div>

<div class="api-node" markdown>

### `setCleanUpBlockNumber` { #fn_setcleanupblocknumber_cbc31cf7 }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function setCleanUpBlockNumber(
    uint256 _blockNumber
) external;
```

Sets clean up block number on managed cleanable tokens.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `_blockNumber` | `uint256` | cleanup block number |

</div>
</div>

<div class="api-node" markdown>

### `switchToProductionMode` { #fn_switchtoproductionmode_f5a98383 }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function switchToProductionMode(
) external;
```

Enter the production mode after all the initial [`governance`](#fn_governance_5aa6e675) settings have been set.
This enables timelocks and the [`governance`](#fn_governance_5aa6e675) can be obtained afterward by calling
[`governanceSettings`](#va_governancesettings).getGovernanceAddress().
Emits [`GovernedProductionModeEntered`](#ev_governedproductionmodeentered).

</div>
</div>

<div class="api-node" markdown>

### `unregisterToken` { #fn_unregistertoken_77860cdd }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function unregisterToken(
    contract IICleanable _cleanableToken
) external;
```

Unregister a token contract from history cleanup index management.

| Parameters | Type | Description |
| ---------- | ---- | ----------- |
| `_cleanableToken` | `contract IICleanable` | The address of the contract to unregister. |

</div>
</div>

<div class="api-node" markdown>

### `updateContractAddresses` { #fn_updatecontractaddresses_b00c0b76 }

<div class="api-node-source" markdown>
Defined in `AddressUpdatable` ([Docs](./AddressUpdatable.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/addressUpdater/implementation/AddressUpdatable.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
function updateContractAddresses(
    bytes32[] _contractNameHashes,
    address[] _contractAddresses
) external;
```

External method called from [`AddressUpdater`](./AddressUpdater.md) only.

</div>
</div>

</div>

<div class="api-node-type" markdown>

## Modifiers

<div class="api-node" markdown>

### `onlyAddressUpdater` { #md_onlyaddressupdater }

<div class="api-node-source" markdown>
Defined in `AddressUpdatable` ([Docs](./AddressUpdatable.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/addressUpdater/implementation/AddressUpdatable.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
modifier onlyAddressUpdater()
```

Only the `AdressUpdater` contract can call this method.
Its address is set at construction time but it can also update itself.

</div>
</div>

<div class="api-node" markdown>

### `onlyGovernance` { #md_onlygovernance }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
modifier onlyGovernance()
```

</div>
</div>

<div class="api-node" markdown>

### `onlyImmediateGovernance` { #md_onlyimmediategovernance }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
modifier onlyImmediateGovernance()
```

</div>
</div>

<div class="api-node" markdown>

### `onlyTrigger` { #md_onlytrigger }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
modifier onlyTrigger()
```

Only the trigger contract can call this method.
This contract is set at construction time and updated through [`AddressUpdatable`](./AddressUpdatable.md).

</div>
</div>

</div>

<div class="api-node-type" markdown>

## Variables

<div class="api-node" markdown>

### `governanceSettings` { #va_governancesettings }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
    contract IGovernanceSettings governanceSettings
```

Governance Settings.

</div>
</div>

<div class="api-node" markdown>

### `productionMode` { #va_productionmode }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
    bool productionMode
```

When true, [`governance`](#fn_governance_5aa6e675) is enabled and cannot be disabled. See [`switchToProductionMode`](#fn_switchtoproductionmode_f5a98383).

</div>
</div>

<div class="api-node" markdown>

### `registeredTokens` { #va_registeredtokens }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
    contract IICleanable[] registeredTokens
```

Current list of token contracts being managed.

</div>
</div>

<div class="api-node" markdown>

### `timelockedCalls` { #va_timelockedcalls }

<div class="api-node-source" markdown>
Defined in `GovernedBase` ([Docs](./GovernedBase.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/governance/implementation/GovernedBase.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
    mapping(bytes4 => struct GovernedBase.TimelockedCall) timelockedCalls
```

List of pending timelocked [`governance`](#fn_governance_5aa6e675) calls.

</div>
</div>

<div class="api-node" markdown>

### `triggerContract` { #va_triggercontract }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
    address triggerContract
```

Address of the contract that can trigger a cleanup.

</div>
</div>

<div class="api-node" markdown>

### `triggerContractName` { #va_triggercontractname }

<div class="api-node-source" markdown>
Defined in `CleanupBlockNumberManager` ([Docs](./CleanupBlockNumberManager.md), [Source](https://gitlab.com/flarenetwork/flare-smart-contracts/-/tree/master/contracts/token/implementation/CleanupBlockNumberManager.sol)).
</div>

<div class="api-node-internal" markdown>

```solidity
    string triggerContractName
```

Name of the contract that can trigger a cleanup.
Needed to update the trigger contract address through the [`AddressUpdater`](./AddressUpdater.md).

</div>
</div>

</div>

